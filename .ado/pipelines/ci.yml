trigger: none

pool:
  vmImage: ubuntu-latest

jobs:
  - job: UnitTests
    timeoutInMinutes: 10

    workspace:
      clean: all

    steps:
      - task: UseDotNet@2
        displayName: "Use .NET Core 3.1 SDK"
        inputs:
          packageType: sdk
          version: 3.1.x

      - task: UseDotNet@2
        displayName: "Use .NET 6 SDK"
        inputs:
          packageType: sdk
          version: 6.0.x

      - task: DotNetCoreCLI@2
        displayName: Restore
        inputs:
          command: restore
          projects: "src/Gsoft.Infra.Mongo.sln"

      - task: DotNetCoreCLI@2
        displayName: Build
        inputs:
          command: build
          projects: "src/Gsoft.Infra.Mongo.sln"
          arguments: "--no-restore --configuration Release /p:TreatWarningsAsErrors=true /warnaserror"
          workingDirectory: src

      - task: DotNetCoreCLI@2
        displayName: Tests
        inputs:
          command: test
          projects: "src/Gsoft.Infra.Mongo.sln"
          arguments: "--no-restore --no-build --configuration Release"
